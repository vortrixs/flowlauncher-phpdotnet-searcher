name: Compile plugin
on:
  workflow_dispatch:

jobs:
    compile_and_publish:
        runs-on: ubuntu-latest
        steps:
          - name: Set up Node.Js
            uses: actions/setup-node@master

          - name: get version
            id: version
            uses: notiz-dev/github-action-json-property@release
            with: 
                path: 'plugin.json'
                prop_path: 'Version'


          - name: Install dependencies
            run: |
                npm install
                zip -r Flow.Launcher.Plugin.PHPDotNetSearcher.zip . -x '*.git*'

          - name: Publish
            uses: softprops/action-gh-release@v1
            with:
              files: 'Flow.Launcher.Plugin.PHPDotNetSearcher.zip'
              tag_name: "v${{steps.version.outputs.prop}}"
            env:
                GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
